<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Embeddable Threaded Discussion Board</title>
  <!--
  HOW TO USE / EMBED
  ===================
  Option A (single page): Open this file directly and the board will work with localStorage.
  Option B (embed on any page):
    1) Copy everything inside <div id="discussion-board"></div> (including the tag) and the <style> + <script> blocks into your page.
    2) The board persists to localStorage in the browser. For production, wire the save/load calls to your backend.

  Features
  --------
  - Main Topics → Subtopics → Threads (original post + replies)
  - Required poster fields: first name, last name, city, state, email
  - Client-side validation
  - LocalStorage persistence (namespaced by window.location.host)
  - Import/Export JSON (for backup or migration to a backend)
  - Clean, responsive UI without external dependencies

  Notes
  -----
  - Replies attach to the original post (one-level deep) for clarity and moderation.
  - To harden for production: add server auth, spam protection, rate limits, and server-side validation.
  -->
  <style>
    :root {
      --bg:#000000; /* black background */
      --panel:#111111;
      --muted:#aaaaaa;
      --text:#ffffff;
      --acc:#C5A95E; /* gold highlight */
      --acc2:#C5A95E;
      --danger:#ff6b6b;
      --line:#333333;
      --chip:#1a1a1a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
    h1,h2,h3{margin:0 0 .25rem 0}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}

    .board{display:grid;grid-template-columns:260px 300px 1fr;gap:16px}
    @media (max-width: 980px){ .board{grid-template-columns:1fr;}}

    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:0 1px 0 #0004, 0 20px 40px #0004}
    .card .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--line)}
    .card .bd{padding:12px 16px}

    .btn{appearance:none;border:0;border-radius:12px;padding:10px 12px;font-weight:600;cursor:pointer;background:var(--acc);color:#000;transition:.15s}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px #0006;background:#d1b977;color:#000}
    .btn.secondary{background:var(--chip);color:var(--text)}
    .btn.secondary:hover{border:1px solid var(--acc);color:var(--acc)}
    .btn.ghost{background:transparent;border:1px solid var(--line);color:var(--text)}
    .btn.ghost:hover{border-color:var(--acc);color:var(--acc)}
    .btn.danger{background:var(--danger);color:#fff}
    .btn.danger:hover{opacity:0.9}

    .row{display:flex;gap:8px;flex-wrap:wrap}

    .list{display:flex;flex-direction:column;gap:8px}
    .item{padding:10px;border:1px solid var(--line);border-radius:12px;background:#0f0f0f;cursor:pointer;transition:.15s}
    .item:hover{border-color:var(--acc);background:#1a1a1a}
    .item.active{outline:2px solid var(--acc2)}
    .item h4{margin:0 0 2px 0;font-size:14px;color:var(--acc)}
    .meta{color:var(--muted);font-size:12px}

    .pill{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px;color:var(--acc)}

    .post{border:1px solid var(--line);border-radius:12px;padding:12px;background:#0f0f0f}
    .post + .post{margin-top:8px}
    .post .title{font-weight:700;margin-bottom:6px;color:var(--acc)}
    .post .content{white-space:pre-wrap}
    .post .author{font-size:12px;color:var(--muted)}

    .reply{margin-left:24px;border-left:3px solid var(--acc);padding-left:12px}

    form{display:grid;gap:10px}
    label{font-weight:600;font-size:12px;color:var(--muted)}
    input, textarea, select{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#000;color:var(--text)}
    input:focus, textarea:focus, select:focus{outline:2px solid var(--acc)}
    textarea{min-height:120px;resize:vertical}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:520px){ .two{grid-template-columns:1fr}}
    .help{font-size:12px;color:var(--muted)}
    .empty{color:var(--muted);padding:8px}
    .toolbar{display:flex;gap:8px;align-items:center}
    .sep{height:1px;background:var(--line);margin:10px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Discussion Board</h1>
    <p class="help">Main topics → subtopics → original post with replies. Stored locally in your browser.</p>

    <div class="board">
      <!-- Topics -->
      <div class="card" id="topicsCard">
        <div class="hd">
          <strong>Topics</strong>
          <button class="btn" id="addTopicBtn">+ Topic</button>
        </div>
        <div class="bd">
          <div class="list" id="topicsList"></div>
        </div>
      </div>

      <!-- Subtopics -->
      <div class="card" id="subtopicsCard">
        <div class="hd">
          <div class="toolbar">
            <strong>Subtopics</strong>
            <span class="pill" id="currentTopicPill">None</span>
          </div>
          <button class="btn" id="addSubtopicBtn">+ Subtopic</button>
        </div>
        <div class="bd">
          <div class="list" id="subtopicsList"></div>
        </div>
      </div>

      <!-- Threads / Posts -->
      <div class="card" id="threadsCard">
        <div class="hd">
          <div class="toolbar">
            <strong>Threads</strong>
            <span class="pill" id="currentSubtopicPill">None</span>
          </div>
          <div class="row">
            <button class="btn" id="newThreadBtn">+ New Thread</button>
            <button class="btn secondary" id="exportBtn">Export</button>
            <label class="btn ghost" for="importInput" style="cursor:pointer">Import</label>
            <input id="importInput" type="file" accept="application/json" style="display:none"/>
            <button class="btn ghost" id="resetBtn" title="Clear all data">Reset</button>
          </div>
        </div>
        <div class="bd" id="threadsBody">
          <div class="empty">Pick a subtopic to view or start a thread.</div>
        </div>
      </div>
    </div>
  </div>

  <template id="topicItemTpl">
    <div class="item"><h4></h4><div class="meta"></div></div>
  </template>
  <template id="subtopicItemTpl">
    <div class="item"><h4></h4><div class="meta"></div></div>
  </template>
  <template id="postTpl">
    <div class="post">
      <div class="title"></div>
      <div class="content"></div>
      <div class="author"></div>
      <div class="row" style="margin-top:8px">
        <button class="btn secondary replyBtn">Reply</button>
        <button class="btn ghost delBtn">Delete</button>
      </div>
    </div>
  </template>

  <!-- Simple modal -->
  <div id="modal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#0008;backdrop-filter:saturate(140%) blur(6px)">
    <div class="card" style="width:min(680px,92vw)">
      <div class="hd"><strong id="modalTitle">Modal</strong><button class="btn ghost" id="modalClose">Close</button></div>
      <div class="bd" id="modalBody"></div>
    </div>
  </div>

  <script>
  (function(){
    const ns = 'discussionBoard:' + (location.host || 'local');
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);

    const store = {
      key: ns,
      load(){
        try{ return JSON.parse(localStorage.getItem(this.key)) || {topics:[], subtopics:[], posts:[]}; }
        catch(e){ return {topics:[], subtopics:[], posts:[]}; }
      },
      save(data){ localStorage.setItem(this.key, JSON.stringify(data)); },
      reset(){ localStorage.removeItem(this.key); }
    };

    let state = store.load();
    let current = { topicId:null, subtopicId:null };

    // UI helpers
    function modal(title, contentNode){
      $('#modalTitle').textContent = title;
      const body = $('#modalBody');
      body.innerHTML = '';
      body.appendChild(contentNode);
      $('#modal').style.display = 'flex';
    }
    function closeModal(){ $('#modal').style.display='none'; }
    $('#modalClose').addEventListener('click', closeModal);
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

    function notify(msg){
      const n = document.createElement('div');
      n.textContent = msg;
      n.style.position='fixed';n.style.right='16px';n.style.bottom='16px';n.style.background='var(--panel)';
      n.style.border='1px solid var(--line)';n.style.padding='10px 12px';n.style.borderRadius='12px';
      n.style.boxShadow='0 12px 30px #0006';n.style.zIndex='9999';
      document.body.appendChild(n);
      setTimeout(()=>n.remove(), 1800);
    }

    // Renderers
    function renderTopics(){
      const list = $('#topicsList');
      list.innerHTML = '';
      if(state.topics.length===0){ list.innerHTML = '<div class="empty">No topics yet.</div>'; return; }
      const tpl = $('#topicItemTpl');
      state.topics.forEach(t=>{
        const el = tpl.content.firstElementChild.cloneNode(true);
        $('h4', el).textContent = t.title;
        const subCount = state.subtopics.filter(s=>s.topicId===t.id).length;
        $('.meta', el).textContent = subCount + ' subtopic' + (subCount!==1?'s':'');
        if(current.topicId===t.id) el.classList.add('active');
        el.addEventListener('click', ()=>{ current.topicId=t.id; current.subtopicId=null; render(); });
        list.appendChild(el);
      });
    }

    function renderSubtopics(){
      const pill = $('#currentTopicPill');
      const list = $('#subtopicsList');
      list.innerHTML = '';
      const topic = state.topics.find(t=>t.id===current.topicId);
      pill.textContent = topic ? topic.title : 'None';
      if(!topic){ list.innerHTML = '<div class="empty">Select a topic.</div>'; return; }
      const subs = state.subtopics.filter(s=>s.topicId===topic.id);
      if(subs.length===0){ list.innerHTML = '<div class="empty">No subtopics yet.</div>'; return; }
      const tpl = $('#subtopicItemTpl');
      subs.forEach(s=>{
        const el = tpl.content.firstElementChild.cloneNode(true);
        $('h4', el).textContent = s.title;
        const threadCount = state.posts.filter(p=>p.subtopicId===s.id && !p.parentPostId).length;
        $('.meta', el).textContent = threadCount + ' thread' + (threadCount!==1?'s':'');
        if(current.subtopicId===s.id) el.classList.add('active');
        el.addEventListener('click', ()=>{ current.subtopicId=s.id; renderThreads(); });
        list.appendChild(el);
      });
    }

    function renderThreads(){
      const pill = $('#currentSubtopicPill');
      const body = $('#threadsBody');
      body.innerHTML = '';
      const sub = state.subtopics.find(s=>s.id===current.subtopicId);
      pill.textContent = sub ? sub.title : 'None';
      if(!sub){ body.innerHTML = '<div class="empty">Pick a subtopic to view or start a thread.</div>'; return; }

      const roots = state.posts
        .filter(p=>p.subtopicId===sub.id && !p.parentPostId)
        .sort((a,b)=>b.createdAt - a.createdAt);

      if(roots.length===0){ body.innerHTML = '<div class="empty">No threads yet. Start one!</div>'; return; }

      roots.forEach(root=>{
        const rootEl = renderPost(root, false);
        body.appendChild(rootEl);
        const replies = state.posts
          .filter(p=>p.parentPostId===root.id)
          .sort((a,b)=>a.createdAt - b.createdAt);
        replies.forEach(r=>{
          const el = renderPost(r, true);
          el.classList.add('reply');
          body.appendChild(el);
        });
      });
    }

    function renderPost(post){
      const tpl = $('#postTpl');
      const el = tpl.content.firstElementChild.cloneNode(true);
      $('.title', el).textContent = post.title || '(no title)';
      $('.content', el).textContent = post.content;
      const who = `${post.firstName} ${post.lastName} • ${post.city}, ${post.state} • ${new Date(post.createdAt).toLocaleString()}`;
      const mail = document.createElement('a'); mail.href = `mailto:${post.email}`; mail.textContent = post.email;
      const meta = document.createElement('div'); meta.className='author'; meta.textContent = who + ' • ';
      meta.appendChild(mail);
      $('.author', el).replaceWith(meta);

      $('.replyBtn', el).addEventListener('click', ()=> openReplyForm(post));
      $('.delBtn', el).addEventListener('click', ()=> deletePost(post));

      return el;
    }

    // Forms
    function topicForm(){
      const f = document.createElement('form');
      f.innerHTML = `
        <div>
          <label>Topic title *</label>
          <input name="title" placeholder="e.g., Marketing Strategies" required />
        </div>
        <div class="row" style="justify-content:flex-end">
          <button type="button" class="btn ghost">Cancel</button>
          <button class="btn">Create Topic</button>
        </div>`;
      $('button[type="button"]', f).onclick = closeModal;
      f.onsubmit = (e)=>{
        e.preventDefault();
        const title = f.title.value.trim();
        if(!title) return;
        const t = { id: uid(), title, createdAt: Date.now() };
        state.topics.push(t); store.save(state);
        current.topicId = t.id; current.subtopicId = null;
        render(); closeModal(); notify('Topic created');
      };
      return f;
    }

    function subtopicForm(){
      const topic = state.topics.find(t=>t.id===current.topicId);
      const f = document.createElement('form');
      f.innerHTML = `
        <div class="help">Under topic: <strong>${topic?topic.title:'(none)'}</strong></div>
        <div>
          <label>Subtopic title *</label>
          <input name="title" placeholder="e.g., SEO" required />
        </div>
        <div class="row" style="justify-content:flex-end">
          <button type="button" class="btn ghost">Cancel</button>
          <button class="btn">Create Subtopic</button>
        </div>`;
      $('button[type="button"]', f).onclick = closeModal;
      f.onsubmit = (e)=>{
        e.preventDefault();
        if(!current.topicId){ alert('Choose a topic first.'); return; }
        const title = f.title.value.trim(); if(!title) return;
        const s = { id: uid(), topicId: current.topicId, title, createdAt: Date.now() };
        state.subtopics.push(s); store.save(state);
        current.subtopicId = s.id;
        render(); closeModal(); notify('Subtopic created');
      };
      return f;
    }

    function threadForm(prefill={}){
      const f = document.createElement('form');
      f.innerHTML = `
        <div class="two">
          <div><label>First name *</label><input name="firstName" required value="${prefill.firstName||''}"/></div>
          <div><label>Last name *</label><input name="lastName" required value="${prefill.lastName||''}"/></div>
        </div>
        <div class="two">
          <div><label>City *</label><input name="city" required value="${prefill.city||''}"/></div>
          <div><label>State *</label><input name="state" required value="${prefill.state||''}"/></div>
        </div>
        <div><label>Email *</label><input name="email" type="email" required value="${prefill.email||''}"/></div>
        <div><label>Thread title *</label><input name="title" required placeholder="e.g., Best lead gen tactics"/></div>
        <div><label>Message *</label><textarea name="content" required placeholder="Start the discussion..."></textarea></div>
        <div class="row" style="justify-content:flex-end">
          <button type="button" class="btn ghost">Cancel</button>
          <button class="btn">Post Thread</button>
        </div>`;
      $('button[type="button"]', f).onclick = closeModal;
      f.onsubmit = (e)=>{
        e.preventDefault();
        if(!current.subtopicId){ alert('Choose a subtopic first.'); return; }
        const data = Object.fromEntries(new FormData(f).entries());
        if(!data.email.includes('@')){ alert('Please enter a valid email.'); return; }
        const post = { id: uid(), subtopicId: current.subtopicId, parentPostId:null, title:data.title.trim(), content:data.content.trim(),
          firstName:data.firstName.trim(), lastName:data.lastName.trim(), city:data.city.trim(), state:data.state.trim(), email:data.email.trim(), createdAt: Date.now() };
        state.posts.push(post); store.save(state);
        renderThreads(); closeModal(); notify('Thread posted');
      };
      return f;
    }

    function replyForm(rootPost){
      const f = document.createElement('form');
      f.innerHTML = `
        <div class="help">Replying to: <strong>${rootPost.title || '(no title)'}</strong></div>
        <div class="two">
          <div><label>First name *</label><input name="firstName" required/></div>
          <div><label>Last name *</label><input name="lastName" required/></div>
        </div>
        <div class="two">
          <div><label>City *</label><input name="city" required/></div>
          <div><label>State *</label><input name="state" required/></div>
        </div>
        <div><label>Email *</label><input name="email" type="email" required/></div>
        <div><label>Reply *</label><textarea name="content" required placeholder="Write your reply..."></textarea></div>
        <div class="row" style="justify-content:flex-end">
          <button type="button" class="btn ghost">Cancel</button>
          <button class="btn">Post Reply</button>
        </div>`;
      $('button[type="button"]', f).onclick = closeModal;
      f.onsubmit = (e)=>{
        e.preventDefault();
        const data = Object.fromEntries(new FormData(f).entries());
        if(!data.email.includes('@')){ alert('Please enter a valid email.'); return; }
        const post = { id: uid(), subtopicId: rootPost.subtopicId, parentPostId: rootPost.id, title: 'Re: ' + (rootPost.title || '(no title)'), content:data.content.trim(),
          firstName:data.firstName.trim(), lastName:data.lastName.trim(), city:data.city.trim(), state:data.state.trim(), email:data.email.trim(), createdAt: Date.now() };
        state.posts.push(post); store.save(state);
        renderThreads(); closeModal(); notify('Reply posted');
      };
      return f;
    }

    function openReplyForm(rootPost){ modal('Reply', replyForm(rootPost)); }

    function deletePost(post){
      if(!confirm('Delete this post? Replies (if any) will also be removed.')) return;
      // remove post and any replies to it (if root)
      const isRoot = !post.parentPostId;
      state.posts = state.posts.filter(p=> p.id!==post.id && (!isRoot || p.parentPostId!==post.id));
      store.save(state); renderThreads(); notify('Deleted');
    }

    // Export / Import / Reset
    $('#exportBtn').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'discussion-board-export.json'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    });
    $('#importInput').addEventListener('change', async (e)=>{
      const file = e.target.files[0]; if(!file) return;
      try{ const text = await file.text(); const data = JSON.parse(text);
        if(!data.topics || !data.subtopics || !data.posts) throw new Error('Invalid file');
        state = data; store.save(state); render(); notify('Import complete');
      }catch(err){ alert('Import failed: ' + err.message); }
      e.target.value = '';
    });
    $('#resetBtn').addEventListener('click', ()=>{
      if(confirm('This will clear all local data for this board on this domain. Continue?')){
        store.reset(); state = store.load(); current={topicId:null, subtopicId:null}; render(); notify('Board reset');
      }
    });

    // Button wiring
    $('#addTopicBtn').addEventListener('click', ()=> modal('New Topic', topicForm()));
    $('#addSubtopicBtn').addEventListener('click', ()=>{
      if(!current.topicId){ alert('Choose a topic first.'); return; }
      modal('New Subtopic', subtopicForm());
    });
    $('#newThreadBtn').addEventListener('click', ()=>{
      if(!current.subtopicId){ alert('Choose a subtopic first.'); return; }
      modal('Start New Thread', threadForm());
    });

    function render(){ renderTopics(); renderSubtopics(); renderThreads(); }
    render();
  })();
  </script>
</body>
</html>